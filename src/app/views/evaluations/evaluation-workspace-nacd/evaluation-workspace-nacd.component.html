<ng2-toasty [position]="'top-center'"></ng2-toasty>

<!-- <p>evaluation-workspace works!</p> -->
<!-- <div class="evalution-workspace-title">
    <div class="row">
        <div class="col-lg-10 col-sm-4">
            <div class="page-title">
                <h2>{{global.language?.evaluations?.evaluationWorkspace?.evaluationTop?.title }} - (Beta)</h2>
            </div>
        </div>
    </div>
</div> -->
<div class="top-header">
    <div class="col">
        <h2 class="header-title">{{global.language?.evaluations?.evaluationWorkspace?.evaluationTop?.title }}
        </h2>
    </div>
</div>

<div class="interactions-sort mb-3" style="height: 70px;">
    <div class="row" style="padding: 0px 0px 0px 16px;width: 100%;">
        <!-- <div style="padding: 0 16px;">
            <div class="evaluate-sub-title">
                <h3 style="margin-top: 3px;">Pick your Evaluation Form</h3>
            </div>
        </div> -->
        <div class="" style="padding: 6px 16px;width: 35%;">
            <div class="form-group">
                <label class="interaction-label" style="font-size: 14px;font-weight: 500;">Active Evaluation
                    Form</label>
                <p-dropdown class="dropdown-interaction dplable" [options]="EvalItemDDL" [(ngModel)]="category"
                    (onChange)="onChangeBlur(); onChangeEvaluationDDl(); nonACDAgentDropdown=false;"
                    [ngModelOptions]="{standalone: true}" filter="true"
                    placeholder="{{global.language?.evaluations?.evaluationWorkspace?.evaluationTop?.sortInteraction?.select}}">
                </p-dropdown>
            </div>
        </div>
        <!-- <div class="" style="padding: 0 16px;width: 20%;">
            <button type="button" id="refresh-btn-dossier" class="btn-sort-interaction" tooltip="Loads the selected evaluation form" placement="top"><i class="fa fa-sign-in mr-3" style="font-size: 15px;" aria-hidden="true"></i>Load Workspace</button>
        </div>
        <div class="" style="padding: 0 16px;width: 20%;">
            <button type="button" class="btn-sort-interaction" (click)="reloadWorkspace()" tooltip="Refresh your display and reset your entire selection" placement="top"><i class="fa fa-refresh mr-3" style="font-size: 15px;" aria-hidden="true"></i> Refresh Session</button>
        </div> -->
        <div class="col-lg-7" style="position: absolute;right: 0px;">
            <label class="interaction-label d-flex ml-auto justify-content-lg-end pt-2"
                style="font-size: 14px;font-weight: 500;">Display Settings</label>
            <div class="d-flex ml-auto justify-content-lg-end mr-1">
                <div class="d-flex mt-2 mr-2 " style="border-right: 1px solid #cdd0d3;height: 25px;">
                    <span class="pr-2 toggle-Grid" >Audio Player</span>
                    <span>
                        <p-inputSwitch class="ipt-switch-platform" [(ngModel)]="isAudioPlayerShow"
                            (onChange)="onChangeAudioLoader(isAudioPlayerShow)" [ngModelOptions]="{standalone: true}"
                            [disabled]="isSwitchDisable">
                        </p-inputSwitch>
                    </span>
                </div>

                <div class="d-flex mt-2  " style="height: 25px;">
                    <span class="pr-2 toggle-Grid" >Interaction Grid</span>
                    <span>
                        <p-inputSwitch class="ipt-switch-platform" [(ngModel)]="isInteractionGrid"
                            [ngModelOptions]="{standalone: true}" [disabled]="isSwitchDisable">
                        </p-inputSwitch>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="interactions-sort mb-3" [ngStyle]="{'display': isInteractionGrid ? 'block' : 'none'}">
    <div class="sort-right" style="height: 550px;width: 100%;">
        <div class="d-flex evaluate-sub-title mb-1">
            <h3 style="margin-top: -4px;white-space: nowrap;">To
                Begin,{{global.language?.evaluations?.evaluationWorkspace?.evaluationTop?.selectInteraction?.title}}
            </h3>
                <div class="d-flex" *ngIf="category!='' && category!=null"
                    style="width: 100%;margin-top: -4px;">
                    <div class="d-flex" *ngIf="currentEvaluationDetails.evalRoomIsNonACD==true">
                        <h3 class="pl-3 pr-3" style="color: gray;">OR</h3>&nbsp;
                        <button type="button" class="btn-sort-interaction pl-3 pr-3" (click)="nonACDresetData()"
                            tooltip="Begin Non-ACD Evaluation" placement="top">
                            <!-- <i class="fa fa-refresh mr-3" style="font-size: 15px;" aria-hidden="true"></i> -->
                            Begin Non-ACD Evaluation
                        </button>
                    </div>
                </div>
                <div class="d-flex mr-3" style="position: absolute;right: 0px;">
                    <div class="mr-3" style="margin-top: -4px">
                        <button type="button" class="btn-sort-interaction pl-3 pr-3" (click)="reloadWorkspace()"
                            tooltip="Refresh your display and reset your entire selection" placement="top" [disabled]="isDisableRefresh"><i
                                class="fa fa-repeat mr-2" style="font-size: 15px;" aria-hidden="true"></i> Refresh
                            Session</button>
                    </div>
                    <div class="mr-3" style="margin-top: -4px">
                        <button type="button" class="btn-sort-interaction pl-3 pr-3 " (click)="ReloadData()"
                            tooltip="Pull and display the latest data" placement="top" [disabled]="isDisableRefresh" ><i class="fa fa-refresh mr-2"
                                style="font-size: 15px;" aria-hidden="true"></i> Refresh Data</button>
                    </div>
                </div>
        </div>
        <div class="table-view"  style="overflow: hidden;" >
            <div class="nonACDnoData"
                *ngIf="isloadSpinner && category != ''">
                <p-progressSpinner></p-progressSpinner>
            </div>
            <div id="dossierContainer1" style="width: 100%; height: 100%;" *ngIf="category != '' ">
            </div>
            <div class="" style="text-align: center;align-items: center;padding-top: 10rem;" *ngIf="category == '' ">
                Select an evaluation form to begin!
            </div>
        </div>
    </div>
</div>

<div class="interaction-players-data mt-0 mb-4">
    <div class="player-left" style="margin-right: 24px;height: 636px;"
        [ngStyle]="{'display': isAudioPlayerShow ? 'block' : 'none'}">
        <div class="player-title">
            {{global.language?.evaluations?.evaluationWorkspace?.evaluationbottom?.bottomLeft?.title}} :
            <span style="font-weight: bold; font-size:14px"> {{currentContact}}</span> 
            <!-- More Selection -->
            <span>
                <div class="dropdown show" style="position: relative" *ngIf="!isAudioSpinner && !nonACDAgentDropdown">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownPlayerLink" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" 
                        style="text-decoration: none; position: absolute; right: 0px; top: -30px;">
                       
                        <div class="rounded-img-letter" id="playerSettings" style="color:#333; background-color: transparent;text-align: right; font-size:20px">
                            <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownPlayerLink" style="width: 180px; padding: 10px; right: 0 !important; box-shadow: 5px 10px 8px #888888;">
                        <h5 style="text-decoration: underline;">Display Settings</h5>
                        <div *ngFor="let category of playerDisplayCategories" class="p-field-checkbox">
                            <p-checkbox name="group2" value="category" [value]="category"  [(ngModel)]="playerSelectedCategories" [inputId]="category.key" (onChange)="checkPlayerValue(category.key ,playerSelectedCategories, $event)" ></p-checkbox>
                            <label [for]="category.key">{{category.name}}</label>
                        </div>    
                    </div>
                </div>
            </span>
            <!-- More Selection -->            
        </div>
        
        <div style="position: relative;"
            [ngStyle]="{'pointer-events' : this.currentContact?.includes('NON-ACD') == true? 'none' : 'auto', 'background-color' : this.currentContact?.includes('NON-ACD') == true? 'lightgray' : ''}">
            <div class="row" style="text-align: center">
                <div class="col-md-12">
                    <div class="noAudioNoNACD"  *ngIf="isAudioSpinner">
                        <p-progressSpinner></p-progressSpinner>
                    </div>
                    <div *ngIf="nonACDAgentDropdown || transcriptTab[0]?.from_user_emailid!=undefined" class="noAudioNoNACD">
                        <h4 style="color: #D10606;">No Audio Data Available</h4>
                        <p class="noAudioNoNACD-sub">Audio Data is only
                            associated with voice based conversations selected from the grid</p>
                    </div>
                    <div *ngIf="!isAudioSpinner && (!nonACDAgentDropdown || transcriptTab[0]?.from_user_emailid!=undefined)" id="audio-spectrum" (click)="getTimeMediaPlayer()" ></div>
                </div>
            </div>
            <div style="background-color: #e4e7ea80;" *ngIf="transcriptTab[0]?.from_user_emailid==undefined">
                <div id="wave-timeline"></div>
                <div id="controls" [ngStyle]="{'pointer-events': nonACDAgentDropdown ?  'none': 'auto'}">
                    <span id="refresh-btn" class="plspan"><i class="fa fa-refresh" aria-hidden="true"
                            data-toggle="tooltip" (click)="refreshBtn()" title="Refresh"></i></span>
                    <span id="play-btn" class="plspan" value="play"><i class="fa fa-play" aria-hidden="true"
                            data-toggle="tooltip" (click)="playandpause()" title="Play/Pause"></i></span>
                    <span id="previous-btn" class="plspan"><i class="fa fa-rotate-left" aria-hidden="true"
                            data-toggle="tooltip" (click)="skipBackward()" title="Backward"></i></span>
                    <span id="next-btn" class="plspan"><i class="fa fa-rotate-right" aria-hidden="true"
                            data-toggle="tooltip" (click)="skipForward()" title="Forward"></i></span>

                    <span id="mute" class="plspan" style="margin-left: 0px;">
                        <i class="fa fa-volume-up"  (click)="volumeChange();" aria-hidden="true" data-toggle="tooltip" title="Mute/Unmute"></i>
                        <span class="plspan showSlider">
                            <input id="volumeSlider" class="volume-slider" type="range" name="volume-slider" min="0" max="100" value="50" [disabled]="disableMute" />
                        </span>
                    </span>
                    
                    <span id="waveform-time-indicator">
                        <div class="timecode">
                            <span id="currentTime">00:00:00</span>
                            <span> / </span>
                            <span id="totalDuration">00:00:00</span>
                            <!-- <span class="playbackRate" (click)=" doublePlaybackSpeed(playbackIndex)">{{ playbackSpeed[playbackIndex] + "x" }}</span>
                            <span class="playbackRateContainer"> 
                                <div class="playbackRateDiv">
                                    <span class="playbackHeader">Playback speed</span>
                                    <button class="btn btn-info play-halfx" data-action="play-halfx">0.5x</button>
                                    <button class="btn btn-info play-1x" data-action="play-1x">0.8x</button>
                                    <button class="btn btn-info play-1and5x" data-action="play-1x">1.0x</button>
                                    <button class="btn btn-info play-1and5x" data-action="play-1x">1.2x</button>
                                    <button class="btn btn-info play-2x" data-action="play-2x">1.5x</button>
                                    <button class="btn btn-info play-2and5x" data-action="play-1x">2.0x</button>
                                </div>
                            </span>  -->
                            <div class="dropup show" style="display:inline-block">
                                <a class="dropdown-toggle" href="#" role="button" id="dropdownplaybackRate" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                                   
                                    <div id="playerSettings" style="color: #9dafcb;">
                                        <span class="playbackRate">{{ playbackIndex + "x" }}</span>
                                    </div>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="dropdownplaybackRate">
                                    <span class="playbackRateContainer" style="position:relative"> 
                                        <div class="playbackRateDiv" style="left: -44px;">
                                            <span class="playbackHeader">Playback speed</span>
                                            <div *ngFor="let speed of playbackSpeed; let i = index">
                                                <a class="btn btn-info play-btnx" [(ngModel)]="playRateSpeedSelected" ngDefaultControl value="speed"
                                                [ngClass]="{active: selectedIndex == i}"
                                                (click)="checkPlayerSpeed(speed, i, $event)">{{ speed + "x" }}</a>
                                            </div>  
                                        </div>
                                    </span>
                                </div>
                            </div>
                            
                        </div>
                    </span> 

                    <span id="notes" class="notes-style" (click)="addnotes()">
                        <!-- <i class="fa fa-sticky-note" aria-hidden="true" data-toggle="tooltip" title="Add Notes"></i> -->
                    </span>           
                </div>
            </div>

            <div id="note-icon" class="notes-popup card-postion" *ngIf="notesPopup == true">
                <div class="form-group ">
                    <div><label class="interaction-label">Add notes</label><label style="float: right;
                            margin-bottom: 4px;" (click)="closenotes()"><button type="button" class="close"
                                style="outline: 0 !important;">&times;</button></label></div>
                    <input type="text" class="form-control ipt-notes-box" [(ngModel)]="notesModel.notes"
                        [ngModelOptions]="{standalone: true}" name="notes" maxlength="128" autocomplete="off">
                    <div class="errormsg-topic" *ngIf="errValNotes==true" style="font-size: 11px;padding: 0;">Please
                        enter the notes</div>
                    <div class="errormsg-topic" *ngIf="conversationID==true" style="font-size: 11px;padding: 0;">Please
                        select interactions for saving notes</div>
                    <div class="errormsg-topic" *ngIf="errTime==true" style="font-size: 11px;padding: 0;">Please select
                        time from media player </div>
                </div>
                <div>
                    <button type="button" class="save-note-btn" (click)="saveNotes()">Save</button>
                </div>
            </div>
        </div>

        <p-tabMenu [model]="items1" [activeItem]="activeTab">
        </p-tabMenu>
        <!-- sutharsan starts -->
        <div class="overflow-eval-workspace evalDetailsBottom" [style.height]="isTopics ? '250px' : '300px' "  *ngIf="tabMenuName==='Topics'">
            <!-- <br /> -->
            <!-- <div *ngIf="getTopicReportTime?.length>0">
                <div class="row hover-topic" *ngFor="let topic of getTopicReportTime; let i=index"  style="cursor: pointer;padding: 0 15px;">
                        <div class="hover-topic-report1 mb-1 col-md-2" style="width: auto;cursor: pointer;" (click)="trancriptSF(topic.time)"> [{{topic.time | timeConvert}}]</div>
                        <div class="hover-topic-report2 mb-1 col-md-10">{{topic.topic}}</div>
                    <br />
                    <br />
                </div>
            </div> -->

            <div *ngIf="getTopicReport?.length>0">
                <div class="row hover-topic" *ngFor="let topic of getTopicReport; let i=index"  style="cursor: pointer;padding: 0 15px;">
                   
                    <div class="" *ngFor="let topicTime of topic.children;let i=index;" style="display: flex;width: 100%;">
                
                        <div class="hover-topic-report1 mb-1 col-md-2" style="width: auto;cursor: pointer;" (click)="trancriptSF(topicTime.element.name)"> [{{topicTime.element.name | timeConvert}}]</div>
                        <div class="hover-topic-report2 mb-1 col-md-10"  *ngIf = "i == 0"  >{{topic.element.name}}</div>
                        
                    </div>
                    <br />
                    <br />
                </div>
            </div>
            
            <div class="nonACDnoData" *ngIf="(getTopicReport?.length == 0 || currentContact == '') && !isEvaluationTabs && !nonACDAgentDropdown">
                <h5> Topics not found!</h5>
            </div>
            <div class="nonACDnoData" *ngIf="nonACDAgentDropdown">
                <h4 style="color: #D10606;">No Topics Available</h4>
            </div>
            <div style="text-align: center;height: 100%;align-items: center;display: grid;" *ngIf="isEvaluationTabs">
                <p-progressSpinner></p-progressSpinner>
            </div>
        </div>

        <div class="overflow-eval-workspace evalDetailsBottom" [style.height]="isTopics ? '250px' : '300px'" *ngIf="tabMenuName==='Transcript'">
            <!-- <p>Transcript Data Process</p> -->
            <div *ngIf="currentContact != '' ">
                <div *ngFor="let tcItem of transcriptTab; let i=index">
                    <div *ngIf="tcItem?.from_user_emailid==undefined" class="row conv hover-conversation">
                        <!--(click)="trancriptSF(tcItem.start_time)"-->
                        <div class="col-md-4 hover-data1" style="left: 12px; " (click)="trancriptSF(tcItem.start_time)">
                            <label
                                *ngIf="tcItem.channel =='Agent' || tcItem.channel =='AGENT' || tcItem.channel =='Workflow' || tcItem.channel =='WORKFLOW'"
                                class="col-form-label">
                                <img src="../../../../assets/img/Evaluation Workspace/icon_user_transcripts.svg" style="background-color: #30BCED;
                                border-radius: 100%;
                                width: 25px;
                                height: 25px;
                                padding: 3px;
                                cursor: pointer;">
                                <span
                                    style="cursor: pointer;margin-left: 8px;">[{{tcItem.start_time|timeConvert}}]</span></label>
                                    <label *ngIf="tcItem.channel =='Customer' || tcItem.channel =='CUSTOMER'"
                                    class="col-form-label">
                                    <img src="../../../../assets/img/Evaluation Workspace/icon_user_transcripts.svg" style="  background-color: #96dfae;
                                    border-radius: 100%;
                                    width: 25px;
                                    height: 25px;
                                    padding: 3px;
                                    cursor: pointer;">
                                    <span style="cursor: pointer;margin-left: 8px;"><b>[{{tcItem.start_time |
                                            timeConvert}}]</b></span></label>
                                <label *ngIf="tcItem.channel =='Workflow' || tcItem.channel =='WORKFLOW'"
                                    class="col-form-label">
                                    <img src="../../../../assets/img/Evaluation Workspace/icon_user_transcripts.svg" style="background-color: #3A3E50;
                                            border-radius: 100%;
                                            width: 25px;
                                            height: 25px;
                                            padding: 3px;
                                            cursor: pointer;">
                                    <span
                                        style="cursor: pointer;margin-left: 8px;">[{{tcItem.start_time|timeConvert}}]</span></label>

                        </div>
                        <div class="col-md-8 hover-data2" style="right: 50px;">
                            <label *ngIf="tcItem.channel =='Agent' || tcItem.channel =='AGENT'"
                                class="col-form-label"><span>{{tcItem.text}}</span></label>
                            <label *ngIf="tcItem.channel =='Customer' || tcItem.channel =='CUSTOMER'"
                                class="col-form-label"><span><b>{{tcItem.text}}</b></span></label>
                            <label *ngIf="tcItem.channel =='Workflow' || tcItem.channel =='WORKFLOW'"
                                class="col-form-label"><span>{{tcItem.text}}</span></label>
                        </div>
                    </div>
                </div>
                <div>
                    <div *ngIf="transcriptTab[0]?.from_user_emailid!=undefined" class="row conv hover-conversation">
                        <p-accordion>
                            <p-accordionTab header="&nbsp;({{tcItem.from_username}} - {{tcItem.channel}})&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{tcItem.start_time}}" *ngFor="let tcItem of transcriptTab; let i=index">
                                <!-- <label *ngIf="tcItem.channel =='Agent' || tcItem.channel =='AGENT' || tcItem.channel =='agent'"
                                class="col-form-label"><span>{{tcItem.from_user_emailid}}</span></label>
                            <label *ngIf="tcItem.channel =='Customer' || tcItem.channel =='CUSTOMER' || tcItem.channel =='customer'"
                                class="col-form-label"><span><b>{{tcItem.text}}</b></span></label>
                            <label *ngIf="tcItem.channel =='Workflow' || tcItem.channel =='WORKFLOW' || tcItem.channel =='workflow'"
                                class="col-form-label"><span>{{tcItem.text}}</span></label> -->

                                <label class="col-form-label"><b>From :&nbsp;</b><span>{{tcItem.from_user_emailid}}&nbsp;({{tcItem.from_username}})</span></label><br>
                                <label class="col-form-label"><b>To :&nbsp;</b><span>{{tcItem.to_user_emailid}}&nbsp;({{tcItem.to_username}})</span></label><br>
                                <label class="col-form-label"><b>Date Time :&nbsp;</b><span>{{tcItem.start_time}}</span></label><br>
                                <label class="col-form-label"><b>Subject :&nbsp;</b><span>{{tcItem.subject}}</span></label><br>
                                <label class="col-form-label"><b>Text :&nbsp;</b><span>{{tcItem.text}}</span></label><br>

                            </p-accordionTab>
                        </p-accordion>
                    </div>
                </div>
            </div>

            <div class="nonACDnoData" *ngIf="(currentContact == '' || transcriptTab.length == 0) && !isEvaluationTabs && !nonACDAgentDropdown">
                <h5> Transcript not found!</h5>
            </div>
            <div class="nonACDnoData" *ngIf="nonACDAgentDropdown" >
                <h4 style="color: #D10606;">No Transcript Available</h4>
            </div>
            <div style="text-align: center;height: 100%;align-items: center;display: grid;" *ngIf="isEvaluationTabs">
                <p-progressSpinner></p-progressSpinner>
            </div>
        </div>
        <!-- sutharsan end -->
        <div class="overflow-eval-workspace evalDetailsBottom" [style.height]="isTopics ? '250px' : '300px'" *ngIf="tabMenuName==='Notes'" style="overflow-y: auto;">
            <div *ngIf="allNotes.length>0">
                <div *ngFor="let item of allNotes; let i=index" [ngClass]="{highlight : i == selectedNoteIndex}">
                    <div class="row conv notes-hover hover-conversation" style="padding-right: 10px">
                        <!--(click)="trancriptSF(tcItem.start_time)"-->
                        <div class="col-md-3 hover-notes-data1" style="left: 10px;" (click)="trancriptSF(item.time)">
                            <label class="col-form-label">
                                <span style="cursor: pointer;margin-left: 8px;">[{{item.time|timeConvert}}]</span>
                            </label>
                        </div>
                        <div class="col-md-8 hover-notes-data2" style="right: 20px;">
                            <label class="col-form-label"><span>{{item.notes}}</span>
                            </label>
                        </div>
                        <div class="col-md-1 hover-data3 pl-0">
                            <img src="../../../../assets/img/microinteraction/delete.svg" data-toggle="modal"
                                data-target="#myModal" (click)="deletepopup(item)">
                        </div>
                    </div>
                </div>
            </div>
            <div class="nonACDnoData" *ngIf="(allNotes.length == 0 || currentContact == '') && !isEvaluationTabs && !nonACDAgentDropdown">
                <!-- <br> -->
                <h5> Notes not found!</h5>
            </div>
            <div class="nonACDnoData" *ngIf="nonACDAgentDropdown">
                <!-- <br> -->
                <h4 style="color: #D10606;">No Notes Available</h4>
            </div>
            <div style="text-align: center;height: 100%;align-items: center;display: grid;" *ngIf="isEvaluationTabs">
                <p-progressSpinner></p-progressSpinner>
            </div>
        </div>

        <div class="overflow-eval-workspace evalDetailsBottom" [style.height]="isTopics ? '250px' : '300px'" *ngIf="tabMenuName==='Screen' && platformId == 2 && isMediaScreen">
            <div *ngIf="videoUrl.length > 0 ">
                <div class="p-3" *ngFor="let screen of videoUrl">
                    <video width="90%" height="100%" controls controlsList="nodownload">
                        <source [src]="screen" type="video/mp4">
                    </video>
                </div>
            </div>
            <div class="nonACDnoData"  *ngIf="(videoUrl.length == 0 || videoUrl == 'processing') && !isMediaScreenLoader && !nonACDAgentDropdown">
               <h5> Screen not found! </h5>
            </div>
            <div class="nonACDnoData" *ngIf="nonACDAgentDropdown">
                <h4 style="color: #D10606;">No Screen Available</h4>
            </div>
            <div style="text-align: center;height: 100%;align-items: center;display: grid;" *ngIf="isMediaScreenLoader">
                <p-progressSpinner></p-progressSpinner>
            </div>
        </div>
    </div>

    <div class="player-right" *ngIf="isEvaluationForm" [ngStyle]="{'width': !isAudioPlayerShow ? '100%' : '50%'}">
        <div class="score-card" style="height: 526px;">
            <div class="evaluation-form">
                <h3>{{global.language?.evaluations?.evaluationWorkspace?.evaluationbottom?.bottomRight?.title}} :
                    {{evalRoomName}}</h3>
                <div class="" *ngIf="AgentDDL">
                    <div class="row">

                        <div class="col-sm-6 pt-1" style="font-size: 13px;color: #9e9a9a;overflow-x: hidden;
                    white-space: nowrap; text-overflow: ellipsis;" tooltip="{{currentContact}}" position="bottom">
                            Conversation ID : <span style="cursor: pointer;">{{currentContact}}</span>
                        </div>
                        <div class="col-sm-6" *ngIf="category!='' && category!=null"
                            style="padding: 12px 16px; padding-left: 10%; width: 20%;">
                            <!-- <button type="button" class="btn-sort-interaction"
                                *ngIf="currentEvaluationDetails.evalRoomIsNonACD==true" (click)="nonACDresetData()"
                                tooltip="Start non-ACD Evaluation" placement="top">
                               
                                Start non-ACD Evaluation
                            </button> -->
                        </div>
                        <div class="col-sm-6" *ngIf="category!='' && category!=null" style="padding: 0 16px;">
                            <div class="row"
                                *ngIf="(ismoderator && allowResubmit) || (allowResubmit && evaluatorDropdown.length > 1)">
                                <div class="col-sm-12">
                                    <!-- <div class="d-flex"> -->
                                    <label class="pt-1 mb-0">Evaluator:</label>&nbsp;
                                    <!-- <div class="w-100"> -->
                                    <p-dropdown class="dropdown-interaction dplable" [options]="evaluatorDropdown"
                                        (onChange)="getEvaluationAns()" [(ngModel)]="selectedEvaluator"
                                        [ngModelOptions]="{standalone: true}" placeholder="No Evaluator yet">
                                    </p-dropdown>
                                    <!-- </div> -->
                                    <!-- </div>  -->
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 pl-0">
                            <!-- <div class="d-flex"> -->
                            <label class="pt-1 mb-0" style="width: 18%;">Agent:</label>&nbsp;
                            <!-- <div style="width: 82%;"> -->
                            <!-- <p-dropdown class="dropdown-interaction" [style]="{'white-space': 'nowrap', 'overflow': 'hidden', 'text-overflow': 'ellipsis'}" [options]="agentDDLform" filter="true" [(ngModel)]="evalFormAgent" 
                                (onChange)="getEvalutionDetail()"  (ngModelChange)="defaultValueAssignForNonACD();" [ngModelOptions]="{standalone: true}" placeholder="Select an Agent"> -->
                            <p-dropdown class="dropdown-interaction dplable" [options]="agentDDLform" filter="true" (onChange)="getEvalutionDetail()"
                                *ngIf="!currentEvaluationDetails.evalRoomIsNonACD || !nonACDAgentDropdown"
                                [(ngModel)]="evalFormAgent"
                                [ngModelOptions]="{standalone: true}" placeholder="Select an agent"></p-dropdown>
                            <!-- <p-dropdown class="dropdown-interaction" [options]="agentDDLform" filter="true" *ngIf="currentEvaluationDetails.evalRoomIsNonACD" [(ngModel)]="evalFormAgent" [ngModelOptions]="{standalone: true}" placeholder="Select an agent for non-ACD evaluation"></p-dropdown> -->
                            <p-dropdown class="dropdown-interaction dplable" [options]="agentDDLform" filter="true"
                                *ngIf="nonACDAgentDropdown" [(ngModel)]="evalFormAgent"
                                (ngModelChange)="defaultValueAssignForNonACD()" [ngModelOptions]="{standalone: true}"
                                placeholder="Select an agent for non-ACD evaluation"></p-dropdown>
                            <!-- </div> -->
                            <!-- </div>  -->
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align: center; font-weight: 500;" *ngIf="category == '' ">
                No data available for interaction!!!
            </div>

            <div class="eval-container-center" style="overflow-y: scroll;overflow-x: hidden;height: 64%;"
                [ngStyle]="{'height' : (ismoderator && allowResubmit) || (allowResubmit && evaluatorDropdown.length > 1) ? '62%' :'62%'}">
                <div class="evaluate-container" *ngFor="let evalItem of questionsList;let j = index;">
                    <div class="evaluate-sub-title" [ngStyle]="{'margin-bottom': !isAudioPlayerShow ? '5px' : '5px'}"
                        *ngIf="evalItem.topicShowHide">
                        <h4>{{evalItem.Topics.topicName}}
                            <!-- <span>(Max Score {{evalItem.score}})</span> -->
                        </h4>
                    </div>
                    <div class="evaluate-subdiv" *ngFor="let ques of evalItem.Topics.questions let i = index;">
                        <div class="row" *ngIf="ques?.conditionalSkipQuestion==true">
                            <!-- <div class="row"> -->
                            <div class="col-sm-7 pr-0">
                                <div class="ques-loop-icon w-100" [ngClass]="!isAudioPlayerShow ? 'mt-2' : ''">
                                    <!--data-toggle="tooltip" title={{ques.question}}-->
                                    <div style="display: flex;width: 89%;">
                                        <!-- <span class="ev-wrkspace-forms"> {{i+1}}.</span>  -->
                                        <span class="evaluate-order-list line-clamp"
                                            tooltip="{{!isAudioPlayerShow ? '' : ques.question}}"
                                            placement="top">{{ques.question}}</span>
                                        <!-- <sup *ngIf="ques.questionMandatory" style="font-size: 7px;color:#afa7a7;"><i class="fa fa-asterisk" aria-hidden="true"></i></sup> -->
                                    </div>
                                    <!-- <div class="ques-ev-forms"> <span class="ev-wrkspace-forms"> {{i+1}}.</span> {{ques.question}}</div>
                               <div class='tooltips'>
                                {{ques.question}}
                               </div> -->
                                    <div style="width: 40px;display: flex;">
                                        <span *ngIf="ques.questionMandatory" style="font-size: 10px;color:#afa7a7;margin-top: 2px;"><i class="fa fa-asterisk" aria-hidden="true"></i></span>

                                        <!-- <span class="info-icon-style"
                                            *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' "
                                            (click)="conformPopOver(i,j)">
                                            <i class="fa fa-info-circle cursor-pointer"  aria-hidden="true"
                                                 placement="bottom"></i>
                                        </span> -->
                                        <ng-template #popTemplate >
                                                <div class="d-flex">
                                                <div  *ngIf="ques.questionDescription != '' && ques.questionDescription != undefined && ques.questionDescription != null" >
                                                <label id="hyper"  style="font-weight:600;font-size:13px"  class="interaction-label pl-1" >{{ques.questionDescription}}</label>
                                                </div>
                                                <!-- <div class=""> -->
                                                <span style="height: 20px;" ><i
                                                    class="fa fa-clone copy-tick-ico ml-2" aria-hidden="true"
                                                    (click)="tickFun(i,j,ques.questionDescription)"></i></span>
                                                <!-- </div> -->
                                                </div>
                                                <div *ngIf="ques.hyperlinkDisplayType != '' && ques.hyperlinkDisplayType != undefined && ques.questionDescription == '' || ques.questionDescription == null || ques.questionDescription == undefined"  style="display: flex;">
                                                    <label   class="interaction-label ml-1 pt-1">Link:</label>
                                                    <span *ngIf="ques.hyperlinkUrl.split('//').length == 1"><a class="icon-hyper-link" href="https://{{ques.hyperlinkUrl}}" target="_blank" tooltip="https://{{ques.hyperlinkUrl}}" >{{ques.hyperlinkDisplayType}}</a></span>
                                                    <span *ngIf="ques.hyperlinkUrl.split('//').length > 1"><a class="icon-hyper-link" href="{{ques.hyperlinkUrl}}" target="_blank" tooltip="{{ques.hyperlinkUrl}}" >{{ques.hyperlinkDisplayType}}</a></span>
                                                </div>
                                        </ng-template>
                                        <div *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' && ques.questionDescription != null">
                                            <div class="cpy-txt" *ngIf="isCopy && indexTexti == i && indexTextj == j"><i
                                                    class="fa fa-check-circle-o copy-tick-ico" aria-hidden="true"
                                                    style="color: #0D7744;"></i>&nbsp;Question Description copied !</div>
                                            </div>

                                        <span   *ngIf="(ques.hyperlinkDisplayType != null && ques.hyperlinkDisplayType != undefined && ques.hyperlinkDisplayType != '') || (ques.questionDescription != null && ques.questionDescription != undefined && ques.questionDescription != '')"  containerClass="popover-custom"  [ngClass]="ques.questionMandatory ? 'ml-2':'ml-3'" [popover]="popTemplate" [outsideClick]="true" placement="top"
                                        (click)="validateLink(ques.hyperlinkDisplayType,ques.questionDescription,ques.hyperlinkUrl)">
                                            <i class="fa fa-info-circle cursor-pointer" style="color: #0D4DCE;font-size: 16px;" aria-hidden="true"
                                        placement="bottom"></i>
                                        </span>

                                        <!-- <div *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' "> -->
                                            <!-- <p-overlayPanel #op2 appendTo="body" styleClass="overlaypanelquestionlink"  [dismissable]="true">
                                                <label *ngIf="ques.questionDescription != ''" class="interaction-label">{{ques.questionDescription}}</label>
                                                <div *ngIf="ques.hyperlinkDisplayType != ''" class="mb-2" style="display: flex;">
                                                    <label class="interaction-label ml-1 pt-1">Link:</label>
                                                    <a href="https://{{ques.hyperlinkUrl}}" target="_blank" tooltip="{{ques.hyperlinkUrl}}" style="padding-left: 10px;text-decoration: underline;color: #0000EE;">{{ques.hyperlinkDisplayType}}</a>
                                                </div>
                                            </p-overlayPanel>    -->
                                        <!-- </div> -->

                                        <!-- <div
                                            *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' ">
                                            <div [ngClass]="ques.hyperlinkDisplayType == '' || ques.hyperlinkDisplayType == undefined ? 'single-box-style-1':'confirm-box-style' "
                                                *ngIf="isConformBox && indexTexti == i && indexTextj == j">
                                                <label  *ngIf="ques.questionDescription != ''"  class="interaction-label pl-1">{{ques.questionDescription}}</label>
                                                <div *ngIf="ques.hyperlinkDisplayType != '' && ques.hyperlinkDisplayType != undefined" class="mb-2" style="display: flex;">
                                                    <label style="font-weight:700;font-size:13px"  class="interaction-label ml-1 pt-1">Link:</label>
                                                    <a href="https://{{ques.hyperlinkUrl}}" target="_blank" style="padding-left: 10px;text-decoration: underline;color: #0000EE;line-height: 23px;">{{ques.hyperlinkDisplayType}}</a>
                                                </div>
                                            </div>
                                        </div> -->

                                        <!-- <div
                                        *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' ">
                                        <div class="confirm-box-style"
                                            *ngIf="isConformBox && indexTexti == i && indexTextj == j">Do you want
                                            to copy question description ? &nbsp;&nbsp;&nbsp;<i
                                                class="fa fa-clone copy-tick-ico mr-2" aria-hidden="true"
                                                (click)="tickFun(i,j,ques.questionDescription)"></i> <i
                                                class="fa fa-times-circle-o ml-1 copy-coss-ico" aria-hidden="true"
                                                (click)="crossFun(i,j)"></i></div>
                                    </div>
                                    <div -->

                                        <!-- <div
                                            *ngIf="ques.questionDescription != undefined && ques.questionDescription != '' ">
                                            <div class="cpy-txt" *ngIf="isCopy && indexTexti == i && indexTextj == j"><i
                                                    class="fa fa-check-circle-o copy-tick-ico" aria-hidden="true"
                                                    style="color: #0D7744;"></i> Description copied !</div>
                                        </div> -->

                                    </div>
                                </div>

                            </div>

                            <div class="col-sm-5">
                                <div class="form-group"
                                    *ngIf="ques.questionChoice=='Number' || ques.questionChoice == null && ques.questionChoice !='Comments'"
                                    style="display: flex;flex-direction: column;">
                                    <!-- <label *ngIf="i==0"
                                [ngStyle]="{'margin-top': !isAudioPlayerShow ? '-4%' : '-15%'}">{{global.language?.evaluations?.evaluationWorkspace?.evaluationbottom?.bottomRight?.score}}</label> -->
                                    <input type="number" step="0.1" autocomplete="off"
                                        class="evaluate-score-box form-control"
                                        [ngStyle]="{'margin-top': !isAudioPlayerShow ? '5px' : '0px'}"
                                        [(ngModel)]="ques.numberValue" [ngModelOptions]="{standalone: true}"
                                        (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0);ConditionalSkipCheckMaxvalue(ques.numberValue, j, i, ques.questionValue)"
                                        (keypress)="keyPress($event)" placeholder="{{ques.questionValue}}"
                                        [disabled]="disableqa">
                                </div>
                                <div class="form-group"
                                    *ngIf="ques.questionChoice !='Number' && ques.questionChoice != null && ques.questionChoice !='Comments'">
                                    <p-dropdown class="dropdwn-category dplable"
                                        *ngIf="ques?.displaytype?.value!='radio'" [options]="ques.questionData"
                                        optionValue="value" [(ngModel)]="ques.answerdata"
                                        [ngModelOptions]="{standalone: true}"
                                        (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0); testtt(ques.answerdata)"
                                        placeholder="Select" [disabled]="disableqa">
                                    </p-dropdown>

                                    <div class="m-0 p-0" *ngIf="ques?.displaytype?.value=='radio'">
                                        <div *ngFor="let val of ques.questionData; let iq=index"
                                            class="p-field-checkbox">
                                            <!-- <p-radioButton name="{{i+iq+1}}" *ngIf="ques?.displaytype?.value=='radio'" [value]="val.value"  [(ngModel)]="ques.answerdata" (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0);" [ngModelOptions]="{standalone: true}" [label]="val?.value?.Answer+' ('+val?.value?.Score+')'" inputId="{{i+iq+1}}"> -->
                                            <p-radioButton [value]="val.value.Answer" [(ngModel)]="ques.answerdata"
                                                (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0); testtt(ques.answerdata)"
                                                [ngModelOptions]="{standalone: true}"
                                                [label]="val?.value?.Answer+' ('+val?.value?.Score+')'">
                                            </p-radioButton>
                                        </div>
                                    </div>
                                </div>

                                <!-- <div class="form-group"
                                    *ngIf="ques.questionChoice !='Number' && ques.questionChoice != null && ques.questionChoice !='Comments'">
                                    <p-dropdown class="dropdwn-category" *ngIf="ques?.displaytype?.value!='radio'"
                                        [options]="ques.questionData" [(ngModel)]="ques.answerdata"
                                        [ngModelOptions]="{standalone: true}"
                                        (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0);"
                                        placeholder="Select" [disabled]="disableqa">
                                    </p-dropdown>

                                    <div *ngFor="let val of ques.questionData; let iq=index" class="p-field-checkbox">
                                        <p-radioButton *ngIf="ques?.displaytype?.value=='radio'" [value]="val.value"
                                            [(ngModel)]="ques.answerdata"
                                            (ngModelChange)="CalculateScore(); conditionalSkipQuestionShow(j, i, questionsList, 0);"
                                            [ngModelOptions]="{standalone: true}"
                                            [label]="val?.value?.Answer+' ('+val?.value?.Score+')'">
                                        </p-radioButton>
                                    </div>
                                </div> -->
                                <div class="form-group"
                                    *ngIf="ques.questionChoice =='Comments' && ques.questionChoice !='Number' ">
                                    <textarea maxlength="2048" name="comments" class="form-control" id="commentid"
                                        style="display: flex;width: 100%;border: 1px solid #a6a6a6;"
                                        (keypress)="textAreaKeys($event)" [(ngModel)]="ques.answerdata"
                                        (ngModelChange)="CalculateScore(); ReplaceSlashFuctionEvaluationForm(ques.answerdata, j, i); conditionalSkipQuestionShow(j, i, questionsList, 0);"
                                        [ngModelOptions]="{standalone: true}" cols="15" rows="2"
                                        placeholder="{{ques.questionValue}}"></textarea>

                                    <!-- <textarea maxlength="2048" name="comments" class="form-control" id="commentid" style="display: flex;width: 100%;border: 1px solid #a6a6a6;"
                      [(ngModel)]="ques.answerdata" cols="15" rows="2" (keypress)="textAreaKeys($event)"
                      [ngModelOptions]="{standalone: true}" (ngModelChange)="CalculateScore(); ques.answerdata=ReplaceSlashFuctionEvaluationForm(ques.answerdata)" placeholder="{{ques.questionValue}}" ></textarea> -->
                                    <!-- [disabled]="disableqa" -->
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- <div *ngIf="global.rolePermissions.evaluate.evaluationWorkspace.isViewEdit == true">
            
            <div class="save-evaluate-btn" *ngIf="questionsList?.length>0">
                <div style="width: 20%;margin-top: 5px;">
                    <p-checkbox  class="check-box-active box-genesys" label="Coached"  [(ngModel)]="evaluatesaveModel.evaluation_coach" [ngModelOptions]="{standalone: true}" binary="false"></p-checkbox>
                </div>
                <div class="form-group">
                    <button type="submit" data-toggle="tooltip" title={{tooltip}} class="btn-save" [disabled]="loading"
                        (click)="evaluationWorkSpaceSave('In Progress')">{{global.language?.evaluations?.evaluationWorkspace?.evaluationbottom?.bottomRight?.save}}</button>
                    <button type="submit" data-toggle="tooltip" class="btn-save"
                        [disabled]="loading" (click)="evaluationWorkSpaceSave('Complete')">Submit</button>
                </div>
            </div>
        </div> -->
            </div>
        </div>

        <div class="score-card" style="margin: 1% 0;">
            <div class="score-card-data">
                <div>Questions: <span style="color: #8AAEF5;">{{totalQues}}</span> / <span
                        style="color: #0D4DCE;">{{totalCountQues}}</span> </div>
                <div>Notes: <span style="color: #8AAEF5;">{{totalNotes}}</span> / <span
                        style="color: #0D4DCE;">{{totalCountNotes}}</span> </div>
                <div>Score: <span style="color: #0D4DCE;">{{totalScore}}</span>
                </div>
            </div>
        </div>

        <div class="score-card" *ngIf="category != '' && category != null">
            <div class="">
                <div *ngIf="global.rolePermissions.evaluate.evaluationWorkspaceNacd.isViewEdit == true">

                    <div class="save-evaluate-btn justify-content-end" style="border-top: 0px; justify-content: flex-end;"
                        *ngIf="questionsList?.length>0">
                        <!-- <div style="width: 20%;margin-top: 5px;">
                            <p-checkbox class="check-box-active box-genesys" label="Coached"
                                [(ngModel)]="evaluatesaveModel.evaluation_coach" [ngModelOptions]="{standalone: true}"
                                binary="false" [disabled]="coachFlag || disablecoach"></p-checkbox>
                        </div> -->
                        <!-- <div style="font-size: 15px;font-weight: 600;margin-top: 6px;color: gray;"> -->
                        <!-- Questions: <span style="color: #0D4DCE;">{{totalQueAns}}</span> &nbsp;&nbsp;
                        Notes: <span style="color: #0D4DCE;">{{TotalComment}}</span> &nbsp;&nbsp; -->
                        <!-- Score: <span style="color: #0D4DCE;">{{totalScore}}</span> &nbsp;&nbsp;
                    </div> -->
                        <div class="form-group">
                            <span id="modalOpen" data-toggle="modal" data-target="#resetModal"></span>
                            <button type="submit" class="btn-delete mr-3" (click)="resetModel()"
                                *ngIf="ismoderator == true || localRole.toLowerCase() == 'admin'">Reset</button>
                            <button type="submit" data-toggle="tooltip" title={{tooltip}} class="btn-save"
                                [disabled]="saveFlagDisable || disableqa"
                                [ngClass]="saveFlagDisable == true || disableqa  ? 'savebtn-disable' : 'btn-save'"
                                (click)="evaluationWorkSpaceSave('In Progress')">{{global.language?.evaluations?.evaluationWorkspace?.evaluationbottom?.bottomRight?.save}}</button>
                            <button type="submit" data-toggle="tooltip" class="btn-save mr-0"
                                [ngClass]="disableqa ? 'savebtn-disable' : 'btn-save'"
                                (click)="evaluationWorkSpaceSave('Complete')"
                                [disabled]=" (loading ||  disableqa)">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Delete modal  -->
    <div class="modal" id="myModal" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content delete-popup">

                <!-- Modal Header -->
                <div class="modal-header" style="border-bottom: 0;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="delete-popup-content">
                        <img src="../assets/img/glyphs_messaging/glyph_danger.svg" style="margin-top: -10px;
                margin-right: 20px;">
                        <h5>Are you sure you want to delete this interaction notes?</h5>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer " style="border-top: 0px;">
                    <div style="margin-left: 3.6%;">
                        <button type="button" class="btn-pop-del" data-dismiss="modal" (click)="deleteNotes()">Delete
                            notes</button>
                        <button type="button" class="btn-pop-cancel" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Modal -->
    <div class="modal" id="resetModal" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content delete-popup">

                <!-- Modal Header -->
                <div class="modal-header" style="border-bottom: 0;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="delete-popup-content">
                        <img src="../assets/img/glyphs_messaging/glyph_danger.svg"
                            style="margin-top: -4px;margin-right: 18px;height: 26px;">
                        <h5>Are you sure you want to reset this evaluation ?</h5>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer " style="border-top: 0px;">
                    <div style="margin-left: 3.6%;">
                        <button type="button" class="btn-pop-del" data-dismiss="modal" style="width: 80px;"
                            (click)="resetData()">Yes</button>
                        <button type="button" class="btn-pop-cancel" data-dismiss="modal">No</button>

                    </div>
                </div>

            </div>
        </div>
    </div>