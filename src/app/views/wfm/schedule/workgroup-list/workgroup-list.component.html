<div class="wfm" #wfm>
    <p-toast [baseZIndex]="999999"></p-toast>
    <!-- Begin top header -->
    <div class="row top-header">
        <div class="col-md-6">
            <h2 class="title">Workgroups</h2>
        </div>
        <div class="col-md-6 text-right">
            <button type="button" class="cust-btn" routerLink="/wfm/schedule/workgroup/create">Create New Workgroup</button>
        </div>
    </div>
    <!-- End top header -->

    <!-- Begin content header -->
    <div class="row content-header">
        <div class="col-12">
            <h4>Manage Your Workgroups</h4>
            <span>Select, Add or Remove Workgroups.</span>
            <!-- <span>{{global.language?.wfm?.workgroup?.list?.subTitle}}</span> -->
        </div>
    </div>
    <!-- End content header -->

    <div class="row custom-row">
        <div class="col-md-6">
            <button
                type="button"
                class="cust-btn-x-sm cust-btn-danger"
                (click)="manageSelectedWorkgroups('delete')"
                [disabled]="!selectedWorkgroups || !selectedWorkgroups.length"
                *ngIf="global.rolePermissions.work.schedule.isViewEdit == true"
            >
                <i class="fa fa-trash-o"></i> {{global.language?.wfm?.deleteBtn}}
            </button>
        </div>
        <div class="col-md-3 text-right">
            <button type="button" (click)="clearFilters(dt)" class="cust-btn-x-sm"><i class="fa fa-filter"></i> {{global.language?.wfm?.clearFilters}}</button>
        </div>
        <div class="col-md-3">
            <div class="has-search">
                <span class="fa fa-search form-control-feedback"></span>
                <input type="text" (input)="dt.filterGlobal($event.target.value, 'startsWith')" class="form-control" placeholder="Search for Workgroups" />
                <span class="text-muted" style="position: absolute;">To search date, the format should be MM/DD/YYYY</span>
            </div>
        </div>
    </div>

    <div style="padding: 32px;">
        <!-- Begin body content -->
        <div class="row">
            <div class="col-lg-12 cust-table">
                <!-- Begin PrimeNG datatable -->
                <p-table
                    #dt
                    dataKey="workgroupId"
                    [value]="workgroups"
                    [lazy]="true" (onLazyLoad)="loadWorkGroups($event)"
                    styleClass="p-datatable-customers"
                    [rowHover]="true"
                    [showCurrentPageReport]="true"
                    [filterDelay]="1200"
                    [globalFilterFields]="['workgroup', 'startDate', 'endDate', 'status', 'updatedTimestamp', 'updatedBy']"
                    [(selection)]="selectedWorkgroups"
                    [loading]="loading"
                >
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th style="width: 3rem;">
                                <p-tableHeaderCheckbox id="frcst_select_all_chkbox" class="cust-chkbox select-all-chkbox"></p-tableHeaderCheckbox>
                            </th>
                            <th pSortableColumn="workgroupName">Workgroups<p-sortIcon field="workgroupName"> </p-sortIcon></th>
                            <th pSortableColumn="severeAdherenceThreshold" *ngIf="col.severeAdherenceThreshold">Adherence Threshold<p-sortIcon field="severeAdherenceThreshold"></p-sortIcon></th>
                            <th pSortableColumn="adherenceTarget" *ngIf="col.adherenceTarget">Adherence Target <p-sortIcon field="adherenceTarget"> </p-sortIcon></th>
                            <th pSortableColumn="adherenceExceptionThreshold" *ngIf="col.adherenceExceptionThreshold">Exception Threshold <p-sortIcon field="adherenceExceptionThreshold"> </p-sortIcon></th>
                            <th pSortableColumn="updatedTimestamp" *ngIf="col.updatedTimestamp">Updated On <p-sortIcon field="updatedTimestamp"> </p-sortIcon></th>
                            <th pSortableColumn="updatedBy" *ngIf="col.updatedBy">Updated By <p-sortIcon field="updatedBy"> </p-sortIcon></th>
                            <th class="text-center">
                                <i (click)="op.toggle($event)" class="pi pi-ellipsis-h font-1xl"></i>
                                <p-overlayPanel #op appendTo="body" styleClass="cust-overlay-panel" [style]="{width: 'auto'}">
                                    <div>
                                        <ul class="list-group">
                                            <li *ngFor="let col of cols" class="list-group-item" (click)="onChangeColumn(col.field, col.enabled)">
                                                <div class="row">
                                                    <div class="col-10" [ngStyle]="{'color': col.enabled ? '#98DFAF' : '#ffffff' }" style="padding-right:2px;">{{col.header}}</div>
                                                    <div class="col-2" [ngStyle]="{'color': col.enabled ? '#98DFAF' : '#ffffff' }" style="padding-left:2px;"><i *ngIf="col.enabled" class="fa fa-check"></i></div>
                                                </div>
                                            </li>
                                          </ul>
                                    </div>
                                </p-overlayPanel>
                            </th>
                        </tr>
                        <tr>
                            <th></th>
                            <th>
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'workgroupName', 'startsWith')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.severeAdherenceThreshold">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'severeAdherenceThreshold', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.adherenceTarget">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'adherenceTarget', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.adherenceExceptionThreshold">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'adherenceExceptionThreshold', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.updatedTimestamp">
                                <p-calendar
                                    (onSelect)="onDateSelect($event,'updatedTimestamp')"
                                    (onClearClick)="dt.filter('', 'updatedTimestamp', 'equals')"
                                    [showButtonBar]="true"
                                    styleClass="p-column-filter"
                                    placeholder="Search"
                                    [readonlyInput]="true"
                                    dateFormat="mm/dd/yy"
                                    appendTo="body"
                                    [baseZIndex]="1022"
                                ></p-calendar>
                            </th>
                            <th *ngIf="col.updatedBy">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'updatedBy', 'startsWith')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th></th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-workgroup let-i="rowIndex">
                        <tr [pSelectableRow]="workgroup">
                            <td>
                                <p-tableCheckbox [value]="workgroup" class="cust-chkbox"></p-tableCheckbox>
                            </td>
                            <td style="text-transform: capitalize;">
                                <a (click)="manageWorkgroup(workgroup,'edit');" tooltip="Click here to edit your Workgroup" class="col-link">{{workgroup.workgroupName}}</a>
                            </td>
                            <td *ngIf="col.severeAdherenceThreshold">
                                {{workgroup.severeAdherenceThreshold}}
                            </td>
                            <td *ngIf="col.adherenceTarget">
                                {{workgroup.adherenceTarget}}
                            </td>
                            <td *ngIf="col.adherenceExceptionThreshold">
                                {{workgroup.adherenceExceptionThreshold}}
                            </td>
                            <td *ngIf="col.updatedTimestamp">
                                {{workgroup.updatedTimestamp}}
                            </td>
                            <td *ngIf="col.updatedBy">
                                {{workgroup.updatedBy}}
                            </td>
                            <td class="text-center">
                                <i (click)="opOptions.toggle($event)" class="pi pi-ellipsis-h font-1xl"></i>
                                <p-overlayPanel #opOptions appendTo="body" styleClass="cust-overlay-panel" [dismissable]="true" [style]="{width: 'auto'}">
                                    <div>
                                        <ul class="list-group">
                                            <li class="list-group-item" (click)="manageWorkgroup(workgroup,'view');" (click)="opOptions.hide();"><i class="icon-eye icons"></i>View</li>
                                            <li class="list-group-item" (click)="manageWorkgroup(workgroup,'edit');" (click)="opOptions.hide();"><i class="fa fa-pencil"></i>Edit</li>
                                            <li class="list-group-item" (click)="manageWorkgroup(workgroup,'view_workplans');" (click)="opOptions.hide();"><i class="icon-eye icons"></i>View Workplans</li>
                                            <li class="list-group-item" (click)="manageWorkgroup(workgroup,'add_workplan');" (click)="opOptions.hide();"><i class="fa fa-plus"></i>Add New Workplan</li>
                                            <li class="list-group-item" (click)="manageWorkgroup(workgroup,'delete')" (click)="opOptions.hide();" style="color: #FC5130 !important"><i class="fa fa-trash-o" style="color: #FC5130 !important"></i>Delete</li>
                                          </ul>
                                    </div>
                                </p-overlayPanel>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td *ngIf="!isLoading" colspan="8" style="text-align: center;">No Record(s) found!</td>
                        </tr>
                    </ng-template>
                </p-table>
                <!-- End PrimeNG datatable -->
                <p-paginator #p (onPageChange)="paginate($event)" [pageLinkSize]="5" [rows]="pageSize" [showCurrentPageReport] = "true" currentPageReportTemplate="Showing {{first}} to {{last}} of {{totalRecords}} entries" [rowsPerPageOptions]="[10,25,50,100]" [totalRecords]="totalRecords" dropdownAppendTo="body"></p-paginator>
            </div>
            <!--/.col-->
        </div>
        <!--/.row-->
        <!-- End body content -->
    </div>

    <!-- Begin workgroup detail dialog -->
    <p-dialog class="cust-dialog" [(visible)]="display" [modal]="true" styleClass="cust-dialog" [baseZIndex]="10000">
        <p-header>
            {{ isViewDetail ? 'Workgroup Details' : (isDeleteConfirm || isDeleteAllConfirm) ? 'Confirm' : ''}}
        </p-header>

        <!-- Begin workgroup detail content -->
        <div *ngIf="workgroup && isViewDetail">
            <div class="row" style="padding-top: 15px; padding-bottom: 15px;">
                <div class="col-lg-6">
                    <div class="card-body">
                        <div class="view-content">
                            <div><span class="text-key capitalize">Name: </span><span
                                    class="text-val capitalize">{{workgroup.workgroupName}}</span></div>
                            <div><span class="text-key">Adherence Threshold: </span><span
                                    class="text-val">{{workgroup.severeAdherenceThreshold }}</span></div>
                            <div><span class="text-key">Exception Threshold: </span><span
                                    class="text-val">{{workgroup.adherenceExceptionThreshold}}</span></div>
                            <div><span class="text-key">Adherence Target: </span><span
                                    class="text-val">{{workgroup.adherenceTarget}}</span></div>
                            <!-- <div><span class="text-key">Wfm Config Id: </span><span
                                    class="text-val">{{workgroup.wfmConfigId}}</span></div> -->
                        </div>
                    </div>
                </div>
                <!--/.col-->
                <div class="col-lg-6">
                    <div class="card-body">
                        <div class="view-content">
                            <div><span class="text-key">Created On: </span><span
                                    class="text-val">{{workgroup.createdTimestamp}}</span></div>
                            <div><span class="text-key">Created By: </span><span class="text-val"
                                    style="text-transform: lowercase;">{{workgroup.createdBy}}</span></div>
                            <div><span class="text-key">Updated On: </span><span
                                    class="text-val">{{workgroup.updatedTimestamp}}</span></div>
                            <div><span class="text-key">Updated By: </span><span class="text-val"
                                    style="text-transform: lowercase;">{{workgroup.updatedBy}}</span></div>
                        </div>
                    </div>
                </div>
                <!--/.col-->
            </div>
            <div class="row" *ngIf="workgroup.workgroupDesc" style="padding-bottom: 15px;">
                <div class="col-12">
                    <div class="card-body">
                        <div>
                            <span class="text-key">Description: </span>
                            <div class="desc"><span class="capitalize">{{workgroup.workgroupDesc}}</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End workgroup detail content -->

        <!-- Begin delete confirmation content -->
        <div *ngIf="isDeleteConfirm || isDeleteAllConfirm">
            <!-- Begin body content -->
            <div class="row">
                <div class="col-12">
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteConfirm && !agentAssignedToWorkgroup?.length">
                        Do you really want to delete the record: {{workgroupName}}?
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteAllConfirm && !agentAssignedToWorkgroup?.length">
                        Do you really want to delete {{selectedWorkgroups.length > 1 ? 'these ' + selectedWorkgroups.length + ' records?' : 'this record?'}}
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteConfirm && agentAssignedToWorkgroup?.length" style="color:#D32F2F;">
                        {{(agentAssignedToWorkgroup.length > 1) ? 'Agents are assigned to '+ workgroupName +'. Do you still want to delete?' : 'Agent assigned to '+ workgroupName +'. Do you still want to delete?'}}
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteAllConfirm && agentAssignedToWorkgroup?.length" style="color:#D32F2F;">
                        {{(agentAssignedToWorkgroup.length > 1) ? 'Agents are assigned to selected workgroups. Do you still want to delete?' : 'Agent assigned to '+ workgroupName +'. Do you still want to delete?'}}
                    </div>
                </div>
            </div>
            <!-- End body content -->

            <!-- Begin action footer content -->
            <div class="row">
                <div class="col-12">
                    <div class="dialog-action-footer">
                        <button type="button" (click)="closeDialog()" pRipple class="cust-btn-outlined" style="width: 200px;">Cancel</button>
                        <button type="submit" (click)="deleteRecord()" *ngIf="isDeleteConfirm" pRipple class="cust-btn" style="width: 200px;" [ngClass]="{'cust-btn-danger': agentAssignedToWorkgroup.length}">Delete</button>
                        <button type="submit" (click)="deleteAllRecords()" *ngIf="isDeleteAllConfirm" pRipple class="cust-btn" style="width: 200px;" [ngClass]="{'cust-btn-danger': agentAssignedToWorkgroup.length}">Delete</button>
                    </div>
                </div>
            </div>

            <!-- End action footer content -->
        </div>
        <!-- End delete confirmation content -->
    </p-dialog>
    <!-- End workgroup detail dialog -->
</div>
