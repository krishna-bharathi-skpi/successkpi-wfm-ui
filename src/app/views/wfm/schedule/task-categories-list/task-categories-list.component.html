<div class="wfm" #wfm>
    <p-toast [baseZIndex]="999999"></p-toast>
    <!-- Begin top header -->
    <div class="row top-header">
        <div class="col-md-6">
            <h2 class="title">Categories</h2>
        </div>
        <div class="col-md-6 text-right">
            <!-- <button type="button" class="cust-btn" routerLink="/wfm/schedule/category/create">Create New Category</button> -->
        </div>
    </div>
    <!-- End top header -->

    <!-- Begin content header -->
    <div class="row content-header">
        <div class="col-12">
            <h4>Manage Your Categories</h4>
            <span>Select, Add or Remove Categories.</span>
            <!-- <span>{{global.language?.wfm?.category?.list?.subTitle}}</span> -->
        </div>
    </div>
    <!-- End content header -->

    <div class="row custom-row">
        <div class="col-md-6">
            <button
                type="button"
                class="cust-btn-x-sm cust-btn-danger"
                (click)="manageSelectedTaskCategories('delete')"
                [disabled]="!selectedTaskCategories || !selectedTaskCategories.length"
                *ngIf="global.rolePermissions.work.schedule.isViewEdit == true"
            >
                <i class="fa fa-trash-o"></i> {{global.language?.wfm?.deleteBtn}}
            </button>
        </div>
        <div class="col-md-3 text-right">
            <button type="button" (click)="clearFilters(dt)" class="cust-btn-x-sm"><i class="fa fa-filter"></i> {{global.language?.wfm?.clearFilters}}</button>
        </div>
        <div class="col-md-3">
            <div class="has-search">
                <span class="fa fa-search form-control-feedback"></span>
                <input type="text" (input)="dt.filterGlobal($event.target.value, 'startsWith')" class="form-control" placeholder="Search for Categories" />
                <span class="text-muted" style="position: absolute;">To search date, the format should be MM/DD/YYYY</span>
            </div>
        </div>
    </div>

    <div style="padding: 32px;">
        <!-- Begin body content -->
        <div class="row">
            <div class="col-lg-12 cust-table">
                <!-- Begin PrimeNG datatable -->
                <p-table
                    #dt
                    dataKey="categoryId"
                    [value]="categories"
                    [lazy]="true" (onLazyLoad)="loadTaskCategories($event)"
                    styleClass="p-datatable-customers"
                    [rowHover]="true"
                    [showCurrentPageReport]="true"
                    [filterDelay]="1200"
                    [globalFilterFields]="['category', 'startDate', 'endDate', 'status', 'updatedTimestamp', 'updatedBy']"
                    [(selection)]="selectedTaskCategories"
                    [loading]="loading"
                >
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th style="width: 3rem;">
                                <p-tableHeaderCheckbox id="frcst_select_all_chkbox" class="cust-chkbox select-all-chkbox"></p-tableHeaderCheckbox>
                            </th>
                            <th pSortableColumn="categoryName">Categories<p-sortIcon field="categoryName"> </p-sortIcon></th>
                            <th pSortableColumn="colorName" *ngIf="col.colorName">Color<p-sortIcon field="colorName"></p-sortIcon></th>
                            <th pSortableColumn="isSchedulable" *ngIf="col.isSchedulable">Is Schedulable <p-sortIcon field="isSchedulable"> </p-sortIcon></th>
                            <th pSortableColumn="isPaid" *ngIf="col.isPaid">Is Paid <p-sortIcon field="isPaid"> </p-sortIcon></th>
                            <th pSortableColumn="isAdherenceRelated" *ngIf="col.isAdherenceRelated">Is Adherence Related <p-sortIcon field="isAdherenceRelated"> </p-sortIcon></th>
                            <th pSortableColumn="updatedTimestamp" *ngIf="col.updatedTimestamp">Updated On <p-sortIcon field="updatedTimestamp"> </p-sortIcon></th>
                            <th pSortableColumn="updatedBy" *ngIf="col.updatedBy">Updated By <p-sortIcon field="updatedBy"> </p-sortIcon></th>
                            <th class="text-center">
                                <i (click)="op.toggle($event)" class="pi pi-ellipsis-h font-1xl"></i>
                                <p-overlayPanel #op appendTo="body" styleClass="cust-overlay-panel" [style]="{width: 'auto'}">
                                    <div>
                                        <ul class="list-group">
                                            <li *ngFor="let col of cols" class="list-group-item" (click)="onChangeColumn(col.field, col.enabled)">
                                                <div class="row">
                                                    <div class="col-10" [ngStyle]="{'color': col.enabled ? '#98DFAF' : '#ffffff' }" style="padding-right:2px;">{{col.header}}</div>
                                                    <div class="col-2" [ngStyle]="{'color': col.enabled ? '#98DFAF' : '#ffffff' }" style="padding-left:2px;"><i *ngIf="col.enabled" class="fa fa-check"></i></div>
                                                </div>
                                            </li>
                                          </ul>
                                    </div>
                                </p-overlayPanel>
                            </th>
                        </tr>
                        <tr>
                            <th></th>
                            <th>
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'categoryName', 'startsWith')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.colorName">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'colorName', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.isSchedulable">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'isSchedulable', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.isPaid">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'isPaid', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.isAdherenceRelated">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'isAdherenceRelated', 'contains')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th *ngIf="col.updatedTimestamp">
                                <p-calendar
                                    (onSelect)="onDateSelect($event,'updatedTimestamp')"
                                    (onClearClick)="dt.filter('', 'updatedTimestamp', 'equals')"
                                    [showButtonBar]="true"
                                    styleClass="p-column-filter"
                                    placeholder="Search"
                                    [readonlyInput]="true"
                                    dateFormat="mm/dd/yy"
                                    appendTo="body"
                                    [baseZIndex]="1022"
                                ></p-calendar>
                            </th>
                            <th *ngIf="col.updatedBy">
                                <input
                                    pInputText
                                    type="text"
                                    (input)="dt.filter($event.target.value, 'updatedBy', 'startsWith')"
                                    placeholder="Search"
                                    class="p-column-filter ui-inputtext ui-corner-all ui-state-default ui-widget"
                                />
                            </th>
                            <th></th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-category let-i="rowIndex">
                        <tr [pSelectableRow]="category">
                            <td>
                                <p-tableCheckbox [value]="category" class="cust-chkbox"></p-tableCheckbox>
                            </td>
                            <td style="text-transform: capitalize;">
                                <a (click)="manageTaskCategory(category,'edit');" tooltip="Click here to edit your Category" class="col-link">{{category.categoryName}}</a>
                            </td>
                            <td *ngIf="col.colorName">
                                {{category.colorName}}
                            </td>
                            <td *ngIf="col.isSchedulable">
                                {{category.isSchedulable}}
                            </td>
                            <td *ngIf="col.isPaid">
                                {{category.isPaid}}
                            </td>
                            <td *ngIf="col.isAdherenceRelated">
                                {{category.isAdherenceRelated}}
                            </td>
                            <td *ngIf="col.updatedTimestamp">
                                {{category.updatedTimestamp}}
                            </td>
                            <td *ngIf="col.updatedBy">
                                {{category.updatedBy}}
                            </td>
                            <td class="text-center">
                                <i (click)="opOptions.toggle($event)" class="pi pi-ellipsis-h font-1xl"></i>
                                <p-overlayPanel #opOptions appendTo="body" styleClass="cust-overlay-panel" [dismissable]="true" [style]="{width: 'auto'}">
                                    <div>
                                        <ul class="list-group">
                                            <!-- <li class="list-group-item" (click)="manageTaskCategory(category,'view');" (click)="opOptions.hide();"><i class="icon-eye icons"></i>View</li> -->
                                            <li class="list-group-item" (click)="manageTaskCategory(category,'delete')" (click)="opOptions.hide();" style="color: #FC5130 !important"><i class="fa fa-trash-o" style="color: #FC5130 !important"></i>Delete</li>
                                          </ul>
                                    </div>
                                </p-overlayPanel>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td *ngIf="!isLoading" colspan="8" style="text-align: center;">No Record(s) found!</td>
                        </tr>
                    </ng-template>
                </p-table>
                <!-- End PrimeNG datatable -->
                <p-paginator #p (onPageChange)="paginate($event)" [pageLinkSize]="5" [rows]="pageSize" [showCurrentPageReport] = "true" currentPageReportTemplate="Showing {{first}} to {{last}} of {{totalRecords}} entries" [rowsPerPageOptions]="[10,25,50,100]" [totalRecords]="totalRecords" dropdownAppendTo="body"></p-paginator>
            </div>
            <!--/.col-->
        </div>
        <!--/.row-->
        <!-- End body content -->
    </div>

    <!-- Begin category detail dialog -->
    <p-dialog class="cust-dialog" [(visible)]="display" [modal]="true" styleClass="cust-dialog" [baseZIndex]="10000">
        <p-header>
            {{ isViewDetail ? 'Category Details' : (isDeleteConfirm || isDeleteAllConfirm) ? 'Confirm' : ''}}
        </p-header>

        <!-- Begin category detail content -->
        <div *ngIf="category && isViewDetail">
            <div class="row" style="padding-top: 15px; padding-bottom: 15px;">
                <div class="col-lg-6">
                    <div class="card-body">
                        <div class="view-content">
                            <div><span class="text-key capitalize">Name: </span><span
                                    class="text-val capitalize">{{category.categoryName}}</span></div>
                            <div><span class="text-key">Adherence Threshold: </span><span
                                    class="text-val">{{category.severeAdherenceThreshold }}</span></div>
                            <div><span class="text-key">Exception Threshold: </span><span
                                    class="text-val">{{category.adherenceExceptionThreshold}}</span></div>
                            <div><span class="text-key">Adherence Target: </span><span
                                    class="text-val">{{category.adherenceTarget}}</span></div>
                            <!-- <div><span class="text-key">Wfm Config Id: </span><span
                                    class="text-val">{{category.wfmConfigId}}</span></div> -->
                        </div>
                    </div>
                </div>
                <!--/.col-->
                <div class="col-lg-6">
                    <div class="card-body">
                        <div class="view-content">
                            <div><span class="text-key">Created On: </span><span
                                    class="text-val">{{category.createdTimestamp}}</span></div>
                            <div><span class="text-key">Created By: </span><span class="text-val"
                                    style="text-transform: lowercase;">{{category.createdBy}}</span></div>
                            <div><span class="text-key">Updated On: </span><span
                                    class="text-val">{{category.updatedTimestamp}}</span></div>
                            <div><span class="text-key">Updated By: </span><span class="text-val"
                                    style="text-transform: lowercase;">{{category.updatedBy}}</span></div>
                        </div>
                    </div>
                </div>
                <!--/.col-->
            </div>
            <div class="row" *ngIf="category.workgroupDesc" style="padding-bottom: 15px;">
                <div class="col-12">
                    <div class="card-body">
                        <div>
                            <span class="text-key">Description: </span>
                            <div class="desc"><span class="capitalize">{{category.workgroupDesc}}</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End category detail content -->

        <!-- Begin delete confirmation content -->
        <div *ngIf="isDeleteConfirm || isDeleteAllConfirm">
            <!-- Begin body content -->
            <div class="row">
                <div class="col-12">
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteConfirm && !agentAssignedToWorkgroup?.length">
                        Do you really want to delete the record: {{categoryName}}?
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteAllConfirm && !agentAssignedToWorkgroup?.length">
                        Do you really want to delete {{selectedTaskCategories.length > 1 ? 'these ' + selectedTaskCategories.length + ' records?' : 'this record?'}}
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteConfirm && agentAssignedToWorkgroup?.length" style="color:#D32F2F;">
                        {{(agentAssignedToWorkgroup.length > 1) ? 'Agents are assigned to '+ categoryName +'. Do you still want to delete?' : 'Agent assigned to '+ categoryName +'. Do you still want to delete?'}}
                    </div>
                    <div class="dialog-body-content confirm-text" *ngIf="isDeleteAllConfirm && agentAssignedToWorkgroup?.length" style="color:#D32F2F;">
                        {{(agentAssignedToWorkgroup.length > 1) ? 'Agents are assigned to selected categories. Do you still want to delete?' : 'Agent assigned to '+ categoryName +'. Do you still want to delete?'}}
                    </div>
                </div>
            </div>
            <!-- End body content -->

            <!-- Begin action footer content -->
            <div class="row">
                <div class="col-12">
                    <div class="dialog-action-footer">
                        <button type="button" (click)="closeDialog()" pRipple class="cust-btn-outlined" style="width: 200px;">Cancel</button>
                        <button type="submit" (click)="deleteRecord()" *ngIf="isDeleteConfirm" pRipple class="cust-btn" style="width: 200px;" [ngClass]="{'cust-btn-danger': agentAssignedToWorkgroup.length}">Delete</button>
                        <button type="submit" (click)="deleteAllRecords()" *ngIf="isDeleteAllConfirm" pRipple class="cust-btn" style="width: 200px;" [ngClass]="{'cust-btn-danger': agentAssignedToWorkgroup.length}">Delete</button>
                    </div>
                </div>
            </div>

            <!-- End action footer content -->
        </div>
        <!-- End delete confirmation content -->
    </p-dialog>
    <!-- End category detail dialog -->
</div>
